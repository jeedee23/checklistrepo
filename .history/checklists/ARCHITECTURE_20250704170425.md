# Application Architecture

## Component Diagram

```
┌─────────────────────────────┐      ┌─────────────────────────┐
│                             │      │                         │
│       User Interface        │      │     Data Management     │
│                             │      │                         │
│  ┌──────────┐ ┌──────────┐  │      │  ┌──────────┐           │
│  │          │ │          │  │      │  │          │           │
│  │ Main UI  │ │  Menus   │  │      │  │  Data    │           │
│  │          │ │          │  │      │  │  Loading │           │
│  └────┬─────┘ └────┬─────┘  │      │  │          │           │
│       │            │        │      │  └────┬─────┘           │
│       │            │        │      │       │                 │
│  ┌────▼─────┐ ┌────▼─────┐  │      │  ┌────▼─────┐           │
│  │          │ │          │  │      │  │          │           │
│  │ Checklist│ │ Context  │  │      │  │  Data    │           │
│  │ Rendering│ │ Menu     │  │      │  │  Saving  │           │
│  │          │ │          │  │      │  │          │           │
│  └────┬─────┘ └────┬─────┘  │      │  └────┬─────┘           │
│       │            │        │      │       │                 │
│       │            │        │      │       │                 │
│  ┌────▼─────┐ ┌────▼─────┐  │      │  ┌────▼─────┐ ┌─────────▼──┐
│  │          │ │          │  │      │  │          │ │            │
│  │ Notifi-  │ │ User     │  │      │  │ Version  │ │ Conflict   │
│  │ cations  │ │ Mgmt     │  │      │  │ History  │ │ Resolution │
│  │          │ │ Dialog   │  │      │  │          │ │            │
│  └──────────┘ └────┬─────┘  │      │  └──────────┘ └────────────┘
│                    │        │      │                         │
│               ┌────▼─────┐   │      │                         │
│               │          │   │      │                         │
│               │ Column   │   │      │                         │
│               │ Manager  │   │      │                         │
│               │          │   │      │                         │
│               └──────────┘   │      │                         │
│                             │      │                         │
└───────────┬─────────────────┘      └─────────────┬───────────┘
            │                                      │
            │                                      │
┌───────────▼──────────────────────────────────────▼───────────┐
│                                                              │
│                     Shared State (constants.js)              │
│                                                              │
│  ┌──────────────┐  ┌─────────────┐  ┌──────────────────────┐ │
│  │              │  │             │  │                      │ │
│  │ checklistData│  │ currentUser │  │ UI State & Settings  │ │
│  │              │  │             │  │                      │ │
│  └──────────────┘  └─────────────┘  └──────────────────────┘ │
│                                                              │
└──────────────────────────────┬───────────────────────────────┘
                               │
                               │
┌──────────────────────────────▼───────────────────────────────┐
│                                                              │
│                     External Integrations                    │
│                                                              │
│  ┌──────────────┐  ┌─────────────┐  ┌──────────────────────┐ │
│  │              │  │             │  │                      │ │
│  │ GitHub API   │  │ Proxy Worker│  │ External Services    │ │
│  │              │  │             │  │                      │ │
│  └──────────────┘  └─────────────┘  └──────────────────────┘ │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## Module Dependency Diagram

```
                  ┌───────────┐
                  │           │
             ┌────► index.js  │
             │    │           │
             │    └─────┬─────┘
             │          │
             │          ▼
┌────────────┴─┐   ┌────────────┐
│              │   │            │
│  app-init.js ◄───┤ constants.js
│              │   │            │
└──┬─────────┬─┘   └───────┬────┘
   │         │             │
   │         │             ▼
   │     ┌───▼─────────────┴────┐
   │     │                      │
   │     │    sharedState       │
   │     │                      │
   │     └───┬─────────────┬────┘
   │         │             │
┌──▼────┐    │         ┌───▼────┐
│       │    │         │        │
│ data.js    │         │ ui     │
│       │    │         │modules │
└───┬───┘    │         └────────┘
    │        │
    │   ┌────▼──────┐
    │   │           │
    └───► events.js │
        │           │
        └───────────┘
```

## Data Flow Diagram

```
  User Input
     │
     ▼
┌────────────┐      ┌───────────────┐
│            │      │               │
│  Events    ├─────►│  Data Updates │
│            │      │               │
└────────────┘      └───────┬───────┘
                            │
                            ▼
                    ┌───────────────┐
                    │               │
                    │ Shared State  │
                    │               │
                    └───────┬───────┘
                            │
                            ▼
          ┌─────────────────┴──────────────────┐
          │                                    │
          ▼                                    ▼
┌───────────────────┐                 ┌────────────────────┐
│                   │                 │                    │
│ UI Re-rendering   │                 │  Data Persistence  │
│                   │                 │                    │
└───────────────────┘                 └────────────────────┘
```

## Authentication Flow

```
┌───────────┐     ┌───────────────┐     ┌──────────────┐
│           │     │               │     │              │
│ Login Form├────►│ Auth Service  ├────►│ User Session │
│           │     │               │     │              │
└───────────┘     └───────┬───────┘     └──────┬───────┘
                          │                    │
                          ▼                    ▼
                  ┌───────────────┐    ┌───────────────┐
                  │               │    │               │
                  │ Access Check  │◄───┤ Shared State  │
                  │               │    │               │
                  └───────┬───────┘    └───────────────┘
                          │
                          ▼
                  ┌───────────────┐
                  │               │
                  │ UI Components │
                  │               │
                  └───────────────┘
```

## Key Data Structures

### Checklist Data Structure
```json
{
  "title": "Project Checklist",
  "type": "Project Management",
  "lastSave": "2025_06_27_@_12-34-56",
  "savedBy": "admin",
  "collaborators": ["user1", "user2"],
  "layout": {
    "columns": {
      "label": { "visible": true, "width": 300 },
      "done": { "visible": true, "width": 50 },
      "who": { "visible": true, "width": 100 },
      "dueDate": { "visible": true, "width": 100 }
    },
    "columnOrder": ["done", "label", "who", "dueDate"],
    "rowHeight": 30
  },
  "items": [
    {
      "label": "Phase 1",
      "done": false,
      "who": "admin",
      "dueDate": "2025-07-15",
      "important": true,
      "children": [
        {
          "label": "Task 1.1",
          "done": true,
          "who": "user1",
          "dueDate": "2025-07-10"
        },
        {
          "label": "Task 1.2",
          "done": false,
          "who": "user2",
          "dueDate": "2025-07-15"
        }
      ]
    }
  ],
  "files": [
    {
      "name": "requirements.pdf",
      "path": "checklists/files/2025_06_20_@_15-24-33_requirements.pdf",
      "uploadedBy": "admin",
      "uploadedAt": "2025_06_20_@_15-24-33"
    }
  ],
  "notes": [
    {
      "id": "note1",
      "path": "checklists/notes/2025_06_22_@_21-35-48.html",
      "createdBy": "admin",
      "createdAt": "2025_06_22_@_21-35-48",
      "itemPath": [0]
    }
  ]
}
```

### User Data Structure
```json
{
  "users": [
    {
      "username": "admin",
      "fullName": "Administrator",
      "passwordHash": "$2a$10$...",
      "email": "admin@example.com",
      "accessLevel": 10,
      "token": "abc123...",
      "lastActive": "2025_06_27_@_12-34-56",
      "checklists": [
        "checklists/2025_06_20_@_15-11-58 Cosucra1.json"
      ]
    }
  ],
  "updatedAt": "2025_06_27_@_12-34-56",
  "updatedBy": "admin"
}
```

## User Management Dialog Architecture

### Design Pattern
The User Management dialog follows a modal popup pattern with Excel-style data presentation:

- **Modal Dialog**: Fixed-position popup with backdrop overlay
- **Flex Layout**: Column-based layout preventing scroll issues
- **Compact Spacing**: Maximum 3px padding/margins for professional density
- **Scrollable Content**: Only the checklist list scrolls when needed

### Key Features
- Dynamic data loading from `users.json`
- Navigation between users with Previous/Next buttons
- Scrollable checklist access list with fixed height (190px)
- Access manager popup integration (placeholder for future development)
- Consistent Consolas 9pt font with light yellow input backgrounds

### File Structure
```
js/
├── user-management.js       # Main dialog logic and rendering
├── menu-system.js          # Menu integration ("Account > Edit Users")
└── constants.js            # Shared state management

code/
├── index.html              # Main container structure
└── css/
    └── style.css           # Additional styling support
```

### Event Flow
1. Menu click triggers `showUserManagement()`
2. `loadUserData()` loads users from `users.json`
3. `createUserManagementDialog()` renders modal with current user
4. User navigation updates `currentUserIndex` and re-renders
5. Checklist items trigger `openAccessManager()` popup
