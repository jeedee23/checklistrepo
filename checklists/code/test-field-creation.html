<!DOCTYPE html>
<html>
<head>
    <title>Field Creation Test</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/menu.css">
</head>
<body>
    <div style="padding: 20px;">
        <h1>Field Creation Test</h1>
        
        <div style="margin-bottom: 20px;">
            <button id="test-new-field" class="primary-btn">Create New Field</button>
            <button id="test-fields-dialog" class="secondary-btn">Open Fields Dialog</button>
        </div>

        <div id="test-results" style="margin-top: 20px;"></div>
        
        <div style="margin-top: 20px;">
            <h3>Current Fields Data:</h3>
            <pre id="fields-data" style="background: #f5f5f5; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script type="module">
        import { showFieldsDialog, showNewFieldDialog } from './js/menu-fields-actions.js';
        import { loadFieldDefinitions } from './js/data-fields.js';
        import { sharedState } from './js/constants.js';

        // Mock minimal shared state for testing
        sharedState.checklistData = { items: [] };
        sharedState.currentUser = { accessLevel: 10 };

        // Mock notification function
        window.showNotification = (type, message) => {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.style.cssText = `
                padding: 10px; 
                margin: 10px 0; 
                border-radius: 4px; 
                background: ${type === 'error' ? '#fee' : type === 'success' ? '#efe' : '#eef'}; 
                color: ${type === 'error' ? '#c33' : type === 'success' ? '#363' : '#333'};
                border: 1px solid ${type === 'error' ? '#faa' : type === 'success' ? '#afa' : '#aaf'};
            `;
            div.textContent = `[${type.toUpperCase()}] ${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        };

        // Function to update the fields data display
        function updateFieldsDisplay() {
            const fieldsData = document.getElementById('fields-data');
            if (sharedState.fieldsData) {
                fieldsData.textContent = JSON.stringify(sharedState.fieldsData, null, 2);
            } else {
                fieldsData.textContent = 'No fields data loaded';
            }
        }

        // Listen for field data updates
        document.addEventListener('dataUpdated', (event) => {
            if (event.detail.type === 'FIELDS') {
                console.log('Fields data updated:', event.detail.data);
                updateFieldsDisplay();
            }
        });

        document.addEventListener('DOMContentLoaded', async () => {
            // Load field definitions
            await loadFieldDefinitions();
            updateFieldsDisplay();
            
            // Set up test buttons
            document.getElementById('test-new-field').addEventListener('click', () => {
                showNewFieldDialog();
            });

            document.getElementById('test-fields-dialog').addEventListener('click', () => {
                showFieldsDialog();
            });
        });
    </script>
</body>
</html>
